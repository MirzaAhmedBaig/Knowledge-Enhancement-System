var globalPath="";var mainApp=angular.module("mainApp",["ngSanitize"]);mainApp.factory("SelectedGroup",function(){var a={};a.id=0;a.name=null;a.type=0;a.questionTypes=[];return a});mainApp.controller("OnLoadController",["$scope","$rootScope","$http",function(b,a,c){b.userScore="";b.imageurl="";c.get("/private/operations/onload.php").success(function(d){if(d.t=="s"){if(d.r==""||d.r==null){globalPath="/images/profile.png"}else{globalPath=d.r}b.imageurl=globalPath}})}]);mainApp.controller("NewGroupController",["$scope","$http",function(a,b){a.groupName="";a.isValidInfo=function(){return a.groupName!=null&&a.groupName!=""&&a.groupName.length<257};a.createGroup=function(){var d=$.param({gn:a.groupName});var c={headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8;"}};b.post("/private/operations/create_group.php",d,c).success(function(e){$("#newGroupModel").modal("toggle");if(e.t=="s"){new Message("Success","Group created successfully.",MESSAGE_SUCCESS).show();window.location="/home"}else{new Message("Error",e.r,MESSAGE_DANGER).show()}});a.groupName=""}}]);mainApp.controller("AskQuestionController",["$scope","$http","SelectedGroup","$rootScope",function(c,d,b,a){c.question=null;c.qDesc=null;c.exDate=null;c.questionTypes=null;c.qType=null;c.isValid=function(){return c.question!=null&&c.question!=""&&c.qType!=null&&c.qType!=""};c.setQuestionTypesList=function(){c.questionTypes=[];var f=$.param({gid:b.id});var e={headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8;"}};d.post("/private/operations/get_all_qt.php",f,e).success(function(g){if(g.t=="s"){for(i=0;i<g.r.length;i++){c.questionTypes[c.questionTypes.length]=[g.r[i][0],g.r[i][1],false]}}else{new Message("Error",g.r,MESSAGE_DANGER).show()}})};a.$on("CallSetQuestionTypesList",function(){c.setQuestionTypesList()});c.askQuestion=function(){var g=new Date(c.exDate);var e=g.getFullYear()+"-"+(g.getMonth()+1)+"-"+g.getDate();var h={gid:b.id,q:c.question,qt:c.qType[0],qd:c.qDesc,ex:e};h=$.param(h);var f={headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8;"}};d.post("/private/operations/add_q.php",h,f).success(function(j){if(j.t=="s"){new Message("Success","Question posted successfully.",MESSAGE_SUCCESS).show()}else{new Message("Error",j.r,MESSAGE_DANGER).show()}})}}]);mainApp.controller("SettingController",["$scope","$rootScope","$http",function(b,a,c){b.username="";b.unickname="";b.usermail="";b.usermobile="";b.userdob="";b.userstreet="";b.usercity="";b.usercountry="";b.imageurl="";b.lock=false;b.error1="";b.error2="";b.error3="";b.sendImage="";c.post("/private/operations/get_user_info.php").success(function(d){if(d.t=="s"){b.username=d.r[0].user_name;b.nickname=d.r[0].nickname;b.usermail=d.r[0].login_id;b.usermobile=d.r[0].mobile;b.userdob=d.r[0].dob;b.userstreet=d.r[0].street;b.usercity=d.r[0].city;b.usercountry=d.r[0].country;b.imageurl=globalPath}});b.isValidInfo=function(){return b.lock!=false};b.updateInfo=function(d){document.getElementById(d).readOnly=false;b.lock=true};b.imgUplaod=function(d){b.$apply(function(f){var g=d.files[0];var e=new FileReader();e.onload=function(k){b.sendImage=k.target.result;b.$apply();if(b.sendImage===null||b.sendImage===""||!(b.sendImage)){return}var j=$.param({image:b.sendImage});var h={headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8;"}};c.post("/private/operations/img_upload.php",j,h).success(function(l){if(l.t=="s"){globalPath=l.r;b.imageurl=globalPath;window.location="/home"}})};e.readAsDataURL(g)})};b.update=function(){var e=/^[0-9]{10}$/;var g=/^[a-zA-Z]*$/;if(!e.test(b.usermobile)){b.error1="Please enter a valid mobile number.";return}if(!g.test(b.usercity)){b.error3="enter valid city...!";return}else{if(b.userstreet==null){b.error2="enter valid city...!";return}}var f=$.param({nname:b.nickname,mob:b.usermobile,street:b.userstreet,city:b.usercity});var d={headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8;"}};c.post("/private/operations/update_user_info.php",f,d).success(function(h){if(h.t=="s"){window.location="/home"}else{new Message("Error",h.r,MESSAGE_DANGER).show()}})}}]);mainApp.controller("AddMembersController",["$scope","$http","SelectedGroup","$rootScope",function(d,f,b,a){d.groupName=null;d.updateName="";d.admin=null;d.members=[];d.specialMembers=[];d.questionTypes=[];d.questionType="";d.ranks=[];d.currentTab=0;d.currentSelectedQuest=0;d.email=null;var c=null;d.isValidKnowenId=function(){return(d.email!=null&&d.email!="")};d.isValidQuestionType=function(){if(d.questionType.length>0){return true}return false};d.isValid=function(){if(d.updateName.length>0){return true}return false};function e(g){for(i=0;i<d.specialMembers.length;i++){if(d.specialMembers[i][0]===g){return true}}for(i=0;i<d.members.length;i++){if(d.members[i][0]===d.email){return true}}return false}d.rename=function(){if(!(d.updateName==b.name)){var h=$.param({gid:b.id,updateName:d.updateName});var g={headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8;"}};f.post("/private/operations/update_grp_name.php",h,g).success(function(j){if(j.t=="s"){b.name=j.r;window.location="/home"}else{new Message("Error",j.r,MESSAGE_DANGER).show()}})}};d.add=function(){if(e(d.email)){new Message("Error","User is already present in group",MESSAGE_DANGER).show();return}var h=$.param({eid:d.email,gid:b.id});var g={headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8;"}};c=d.email;if(d.currentTab==0){f.post("/private/operations/add_sm.php",h,g).success(function(j){if(j.t=="e"){new Message("Error",j.r,MESSAGE_DANGER).show()}else{if(b.type==1){d.specialMembers[d.specialMembers.length]=[c,j.r,false]}else{d.specialMembers[d.specialMembers.length]=[c,j.r]}}});d.email=""}else{if(d.currentTab==1){f.post("/private/operations/add_m.php",h,g).success(function(j){if(j.t=="e"){new Message("Error",j.r,MESSAGE_DANGER).show()}else{if(b.type==1||b.type==2){d.members[d.members.length]=[c,j.r,false]}else{d.members[d.members.length]=[c,j.r]}}});d.email=""}else{h=$.param({qt:d.questionType,gid:b.id});c=d.questionType;f.post("/private/operations/add_qt.php",h,g).success(function(j){if(j.t=="e"){new Message("Error",j.r,MESSAGE_DANGER).show()}else{d.questionTypes[d.questionTypes.length]=[j.r,c,false]}});d.questionType=""}}};d.hasPermission=function(){if((d.currentTab==0&&b.type==1)||(d.currentTab==1&&((b.type==1||b.type==2)))){return true}return false};d.isAdmin=function(){return b.type==1};d.remove=function(){var h={headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8;"}};var j=null;if(d.currentTab==0){var g=d.specialMembers.filter(function(m){return m[2]});d.specialMembers=d.specialMembers.filter(function(m){return !m[2]});for(i=0;i<g.length;i++){if(g[i][2]){j=$.param({eid:g[i][0],gid:b.id});f.post("/private/operations/remove_sm.php",j,h).success(function(m){if(m.t=="e"){new Message("Error",m.r,MESSAGE_DANGER).show()}})}}}else{if(d.currentTab==1){var l=d.members.filter(function(m){return m[2]});d.members=d.members.filter(function(m){return !m[2]});for(i=0;i<l.length;i++){if(l[i][2]){j=$.param({eid:l[i][0],gid:b.id});f.post("/private/operations/remove_m.php",j,h).success(function(m){if(m.t=="e"){new Message("Error",m.r,MESSAGE_DANGER).show()}})}}}else{var k=d.questionTypes.filter(function(m){return m[2]});d.questionTypes=d.questionTypes.filter(function(m){return !m[2]});for(i=0;i<k.length;i++){if(k[i][2]){j=$.param({qid:k[i][0],gid:b.id});f.post("/private/operations/remove_qt.php",j,h).success(function(m){if(m.t=="e"){new Message("Error",m.r,MESSAGE_DANGER).show()}})}}}}};d.deleteGroup=function(){var h=$.param({gid:b.id});var g={headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8;"}};f.post("/private/operations/delete_group.php",h,g).success(function(j){if(j.t=="s"){window.location="/home"}else{new Message("Error",j.r,MESSAGE_DANGER).show()}})};d.setMembersList=function(){console.log("Calling Members");d.members=[];d.specialMembers=[];d.questionTypes=[];d.ranks=[];var h=$.param({gid:b.id});var g={headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8;"}};f.post("/private/operations/get_all_sm.php",h,g).success(function(j){for(i=0;i<j.r.length;i++){if(b.type==1){d.specialMembers[d.specialMembers.length]=[j.r[i][0],j.r[i][1],false]}else{d.specialMembers[d.specialMembers.length]=[j.r[i][0],j.r[i][1]]}}});f.post("/private/operations/get_all_m.php",h,g).success(function(j){for(i=0;i<j.r.length;i++){if(b.type==1||b.type==2){d.members[d.members.length]=[j.r[i][0],j.r[i][1],false]}else{d.members[d.members.length]=[j.r[i][0],j.r[i][1]]}}});f.post("/private/operations/get_admin.php",h,g).success(function(j){if(j.t=="s"){d.admin=j.r;if(b.type==1){d.admin[1]="You"}}else{d.admin=""}});f.post("/private/operations/get_toppers_list.php",h,g).success(function(j){if(j.t=="s"){d.ranks=j.r;console.log("Ranks: "+j.r)}});if(b.type==1){f.post("/private/operations/get_all_qt.php",h,g).success(function(j){if(j.t=="s"){for(i=0;i<j.r.length;i++){d.questionTypes[d.questionTypes.length]=[j.r[i][0],j.r[i][1],false]}}else{new Message("Error",j.r,MESSAGE_DANGER).show()}})}d.groupName=b.name};a.$on("CallSetMembersList",function(){d.setMembersList()})}]);mainApp.controller("MainAppController",["$scope","$http","SelectedGroup","$rootScope","$compile",function(c,f,b,a,e){c.GroupList=[];c.GroupList.admins=[];c.GroupList.specialMembers=[];c.GroupList.members=[];c.questions=[];c.answers=[];c.currentTab=0;c.showQCommentBoxFlag=false;c.qComment=null;c.questionLikes=0;c.answerLikes=0;c.next=false;c.previous=false;c.AprofilePic="";f.get("/private/operations/get_all_admin_groups.php").success(function(g){c.GroupList.admins=g.r;c.profilePic=globalPath});f.get("/private/operations/get_all_sm_groups.php").success(function(g){c.GroupList.specialMembers=g.r});f.get("/private/operations/get_all_m_groups.php").success(function(g){c.GroupList.members=g.r});function d(h){var j=$.param({gid:h});var g={headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8;"}};f.post("/private/operations/get_all_qt.php",j,g).success(function(k){if(k.t=="s"){b.questionTypes=k.r}})}c.getQTName=function(g){for(i=0;i<b.questionTypes.length;i++){if(b.questionTypes[i][0]==g){return b.questionTypes[i][1]}}};c.changeGroup=function(k,h){c.currentTab=0;c.previous=false;c.next=false;if(b.id==k){return}$("#gh-"+b.id).removeClass("active");$("#gh-"+k).addClass("active");$("#gc-"+b.id).hide();d(k);var l=$.param({gid:k});var j={headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8;"}};var g=angular.fromJson(localStorage.getItem("gc"+k));if(g!==null){c.questions=g}else{f.post("/private/operations/get_group_questions.php",l,j).success(function(m){if(m.t==="s"){localStorage.setItem("gc"+k,angular.toJson(m.r));c.questions=angular.fromJson(localStorage.getItem("gc"+k))}else{new Message("Error",m.r,MESSAGE_DANGER).show()}})}b.id=k;b.type=h;if(h==1){angular.forEach(c.GroupList.admins,function(n,m){if(n[0]==k){b.name=n[1]}})}else{if(h==2){angular.forEach(c.GroupList.specialMembers,function(n,m){if(n[0]==k){b.name=n[1]}})}else{angular.forEach(c.GroupList.members,function(n,m){if(m[0]==k){b.name=m[1]}})}}f.post("/private/operations/get_group_score.php",l,j).success(function(m){if(m.t==="s"){c.questionLikes=m.r[0];c.answerLikes=m.r[1]}})};c.refreshGroup=function(){if(c.currentTab==0){var h=$.param({gid:b.id});var g={headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8;"}};f.post("/private/operations/get_group_questions.php",h,g).success(function(j){if(j.t==="s"){localStorage.setItem("gc"+b.id,angular.toJson(j.r));c.questions=angular.fromJson(localStorage.getItem("gc"+b.id))}else{new Message("Error",j.r,MESSAGE_DANGER).show()}})}else{c.showAnswers(c.currentSelectedQuest);c.previous=true}};c.showAnswers=function(h){if(h!=null){c.currentSelectedQuest=h;var j=$.param({qid:h});var g={headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8;"}};f.post("/private/operations/get_a.php",j,g).success(function(k){if(k.t==="s"){c.answers=k.r;console.log(k.r);c.applyLikesStyle()}})}c.currentTab=1;c.previous=true};c.openQCommentBox=function(g){openQCommentBox(g);e($("#qcomment"+g))(c)};c.openACommentBox=function(g){openACommentBox(g);e($("#acomment"+g))(c)};c.openSolutionBox=function(g){openSolutionBox(g);e($("#soln"+g))(c)};c.showQuestions=function(){c.next=true;c.currentTab=0};c.isGroupSelected=function(){return b.type!=0};c.isNavigated=function(){return c.previous};c.isBacked=function(){return c.next};c.applyLikesStyle=function(){$(function(){var g=$(".qframe>.stars");g.each(function(){$(this).combostars({selected:$(this).data("oldlikes")})});g.on("change",function(){var j=$.param({id:$(this).data("id"),likes:$(this).val()});var h={headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8;"}};if($(this).data("type")=="q"){f.post("/private/operations/set_q_rank.php",j,h)}else{f.post("/private/operations/set_a_rank.php",j,h)}})})};c.sendLikes=function(g,h,k){var j=angular.element(k.srcElement)};c.sendQComment=function(g){var j=$.param({qid:g,comment:$("#qcomment"+g).find(".editable").html()});var h={headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8;"}};f.post("/private/operations/add_q_comment.php",j,h).success(function(k){if(k.t==="s"){$("#qcomment"+g).remove();c.refreshGroup()}else{}})};c.sendAComment=function(j){var h=$.param({aid:j,comment:$("#acomment"+j).find(".editable").html()});var g={headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8;"}};f.post("/private/operations/add_a_comment.php",h,g).success(function(k){if(k.t==="s"){$("#acomment"+j).remove();c.refreshGroup()}else{}})};c.sendSolution=function(g){var j=$.param({qid:g,soln:$("#soln"+g).find(".editable").html()});var h={headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8;"}};f.post("/private/operations/add_solution.php",j,h).success(function(k){if(k.t=="s"){$("#soln"+g).remove();c.refreshGroup()}else{}})};c.setRating=function(g){};c.setQuestionTypesList=function(){a.$emit("CallSetQuestionTypesList",{})};c.setMembersList=function(){a.$emit("CallSetMembersList",{})}}]);