function MediumEditor(d,c){return this.init(d,c)}"object"==typeof module&&(module.exports=MediumEditor),function(j,i){function p(e,d){var f;if(void 0===e){return d}for(f in d){d.hasOwnProperty(f)&&e.hasOwnProperty(f)===!1&&(e[f]=d[f])}return e}function o(){var a,h,g,f=j.getSelection();if(f.getRangeAt&&f.rangeCount){for(g=[],a=0,h=f.rangeCount;h>a;a+=1){g.push(f.getRangeAt(a))}return g}return null}function n(a){var h,g,f=j.getSelection();if(a){for(f.removeAllRanges(),h=0,g=a.length;g>h;h+=1){f.addRange(a[h])}}}function m(){var b=i.getSelection().anchorNode,d=b&&3===b.nodeType?b.parentNode:b;return d}function l(){var r,q,h,b,a="";if(void 0!==j.getSelection){if(q=j.getSelection(),q.rangeCount){for(b=i.createElement("div"),r=0,h=q.rangeCount;h>r;r+=1){b.appendChild(q.getRangeAt(r).cloneContents())}a=b.innerHTML}}else{void 0!==i.selection&&"Text"===i.selection.type&&(a=i.selection.createRange().htmlText)}return a}function k(b){return !(!b||1!==b.nodeType)}MediumEditor.prototype={defaults:{allowMultiParagraphSelection:!0,anchorInputPlaceholder:"Paste or type a link",anchorPreviewHideDelay:500,buttons:["bold","italic","underline","anchor","header1","header2","quote"],buttonLabels:!1,checkLinkFormat:!1,cleanPastedHTML:!1,delay:0,diffLeft:0,diffTop:-10,disableReturn:!1,disableDoubleReturn:!1,disableToolbar:!1,disableEditing:!1,elementsContainer:!1,firstHeader:"h3",forcePlainText:!0,placeholder:"Type your text",secondHeader:"h4",targetBlank:!1,extensions:{},activeButtonClass:"medium-editor-button-active",firstButtonClass:"medium-editor-button-first",lastButtonClass:"medium-editor-button-last"},isIE:"Microsoft Internet Explorer"===navigator.appName||"Netscape"===navigator.appName&&null!==new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})").exec(navigator.userAgent),init:function(b,c){return this.setElementSelection(b),0!==this.elements.length?(this.parentElements=["p","h1","h2","h3","h4","h5","h6","blockquote","pre"],this.id=i.querySelectorAll(".medium-editor-toolbar").length+1,this.options=p(c,this.defaults),this.setup()):void 0},setup:function(){this.isActive=!0,this.initElements().bindSelect().bindPaste().setPlaceholders().bindWindowActions().passInstance()},initElements:function(){this.updateElementList();var b,d=!1;for(b=0;b<this.elements.length;b+=1){this.options.disableEditing||this.elements[b].getAttribute("data-disable-editing")||this.elements[b].setAttribute("contentEditable",!0),this.elements[b].getAttribute("data-placeholder")||this.elements[b].setAttribute("data-placeholder",this.options.placeholder),this.elements[b].setAttribute("data-medium-element",!0),this.bindParagraphCreation(b).bindReturn(b).bindTab(b),this.options.disableToolbar||this.elements[b].getAttribute("data-disable-toolbar")||(d=!0)}return d&&(this.options.elementsContainer||(this.options.elementsContainer=i.body),this.initToolbar().bindButtons().bindAnchorForm().bindAnchorPreview()),this},setElementSelection:function(b){this.elementSelection=b,this.updateElementList()},updateElementList:function(){this.elements="string"==typeof this.elementSelection?i.querySelectorAll(this.elementSelection):this.elementSelection,1===this.elements.nodeType&&(this.elements=[this.elements])},serialize:function(){var e,d,f={};for(e=0;e<this.elements.length;e+=1){d=""!==this.elements[e].id?this.elements[e].id:"element-"+e,f[d]={value:this.elements[e].innerHTML.trim()}}return f},callExtensions:function(f){if(!(arguments.length<1)){var e,h,g=Array.prototype.slice.call(arguments,1);for(h in this.options.extensions){this.options.extensions.hasOwnProperty(h)&&(e=this.options.extensions[h],void 0!==e[f]&&e[f].apply(e,g))}}},passInstance:function(){var e,d,f=this;for(d in f.options.extensions){f.options.extensions.hasOwnProperty(d)&&(e=f.options.extensions[d],e.parent&&(e.base=f))}return f},bindParagraphCreation:function(b){var d=this;return this.elements[b].addEventListener("keypress",function(e){var g,f=m();32===e.which&&(g=f.tagName.toLowerCase(),"a"===g&&i.execCommand("unlink",!1,null))}),this.elements[b].addEventListener("keyup",function(c){var g,f=m();f&&f.getAttribute("data-medium-element")&&0===f.children.length&&!d.options.disableReturn&&!f.getAttribute("data-disable-return")&&i.execCommand("formatBlock",!1,"p"),13===c.which&&(f=m(),g=f.tagName.toLowerCase(),d.options.disableReturn||this.getAttribute("data-disable-return")||"li"===g||d.isListItemChild(f)||(c.shiftKey||i.execCommand("formatBlock",!1,"p"),"a"===g&&i.execCommand("unlink",!1,null)))}),this},isListItemChild:function(e){for(var d=e.parentNode,f=d.tagName.toLowerCase();-1===this.parentElements.indexOf(f)&&"div"!==f;){if("li"===f){return !0}if(d=d.parentNode,!d||!d.tagName){return !1}f=d.tagName.toLowerCase()}return !1},bindReturn:function(d){var c=this;return this.elements[d].addEventListener("keypress",function(b){if(13===b.which){if(c.options.disableReturn||this.getAttribute("data-disable-return")){b.preventDefault()}else{if(c.options.disableDoubleReturn||this.getAttribute("data-disable-double-return")){var e=m();e&&"\n"===e.innerText&&b.preventDefault()}}}}),this},bindTab:function(b){return this.elements[b].addEventListener("keydown",function(d){if(9===d.which){var e=m().tagName.toLowerCase();"pre"===e&&(d.preventDefault(),i.execCommand("insertHtml",null,"    "))}}),this},buttonTemplate:function(e){var d=this.getButtonLabels(this.options.buttonLabels),f={bold:'<button class="medium-editor-action medium-editor-action-bold" data-action="bold" data-element="b">'+d.bold+"</button>",italic:'<button class="medium-editor-action medium-editor-action-italic" data-action="italic" data-element="i">'+d.italic+"</button>",underline:'<button class="medium-editor-action medium-editor-action-underline" data-action="underline" data-element="u">'+d.underline+"</button>",strikethrough:'<button class="medium-editor-action medium-editor-action-strikethrough" data-action="strikethrough" data-element="strike"><strike>A</strike></button>',superscript:'<button class="medium-editor-action medium-editor-action-superscript" data-action="superscript" data-element="sup">'+d.superscript+"</button>",subscript:'<button class="medium-editor-action medium-editor-action-subscript" data-action="subscript" data-element="sub">'+d.subscript+"</button>",anchor:'<button class="medium-editor-action medium-editor-action-anchor" data-action="anchor" data-element="a">'+d.anchor+"</button>",image:'<button class="medium-editor-action medium-editor-action-image" data-action="image" data-element="img">'+d.image+"</button>",header1:'<button class="medium-editor-action medium-editor-action-header1" data-action="append-'+this.options.firstHeader+'" data-element="'+this.options.firstHeader+'">'+d.header1+"</button>",header2:'<button class="medium-editor-action medium-editor-action-header2" data-action="append-'+this.options.secondHeader+'" data-element="'+this.options.secondHeader+'">'+d.header2+"</button>",quote:'<button class="medium-editor-action medium-editor-action-quote" data-action="append-blockquote" data-element="blockquote">'+d.quote+"</button>",orderedlist:'<button class="medium-editor-action medium-editor-action-orderedlist" data-action="insertorderedlist" data-element="ol">'+d.orderedlist+"</button>",unorderedlist:'<button class="medium-editor-action medium-editor-action-unorderedlist" data-action="insertunorderedlist" data-element="ul">'+d.unorderedlist+"</button>",pre:'<button class="medium-editor-action medium-editor-action-pre" data-action="append-pre" data-element="pre">'+d.pre+"</button>",indent:'<button class="medium-editor-action medium-editor-action-indent" data-action="indent" data-element="ul">'+d.indent+"</button>",outdent:'<button class="medium-editor-action medium-editor-action-outdent" data-action="outdent" data-element="ul">'+d.outdent+"</button>"};return f[e]||!1},getButtonLabels:function(f){var e,h,g={bold:"<b>B</b>",italic:"<b><i>I</i></b>",underline:"<b><u>U</u></b>",superscript:"<b>x<sup>1</sup></b>",subscript:"<b>x<sub>1</sub></b>",anchor:"<b>#</b>",image:"<b>image</b>",header1:"<b>H1</b>",header2:"<b>H2</b>",quote:"<b>&ldquo;</b>",orderedlist:"<b>1.</b>",unorderedlist:"<b>&bull;</b>",pre:"<b>0101</b>",indent:"<b>&rarr;</b>",outdent:"<b>&larr;</b>"};if("fontawesome"===f?e={bold:'<i class="fa fa-bold"></i>',italic:'<i class="fa fa-italic"></i>',underline:'<i class="fa fa-underline"></i>',superscript:'<i class="fa fa-superscript"></i>',subscript:'<i class="fa fa-subscript"></i>',anchor:'<i class="fa fa-link"></i>',image:'<i class="fa fa-picture-o"></i>',quote:'<i class="fa fa-quote-right"></i>',orderedlist:'<i class="fa fa-list-ol"></i>',unorderedlist:'<i class="fa fa-list-ul"></i>',pre:'<i class="fa fa-code fa-lg"></i>',indent:'<i class="fa fa-indent"></i>',outdent:'<i class="fa fa-outdent"></i>'}:"object"==typeof f&&(e=f),"object"==typeof e){for(h in e){e.hasOwnProperty(h)&&(g[h]=e[h])}}return g},initToolbar:function(){return this.toolbar?this:(this.toolbar=this.createToolbar(),this.keepToolbarAlive=!1,this.anchorForm=this.toolbar.querySelector(".medium-editor-toolbar-form-anchor"),this.anchorInput=this.anchorForm.querySelector("input"),this.toolbarActions=this.toolbar.querySelector(".medium-editor-toolbar-actions"),this.anchorPreview=this.createAnchorPreview(),this)},createToolbar:function(){var b=i.createElement("div");return b.id="medium-editor-toolbar-"+this.id,b.className="medium-editor-toolbar",b.appendChild(this.toolbarButtons()),b.appendChild(this.toolbarFormAnchor()),this.options.elementsContainer.appendChild(b),b},toolbarButtons:function(){var b,t,s,r,q=this.options.buttons,h=i.createElement("ul");for(h.id="medium-editor-toolbar-actions",h.className="medium-editor-toolbar-actions clearfix",t=0;t<q.length;t+=1){this.options.extensions.hasOwnProperty(q[t])?(r=this.options.extensions[q[t]],s=void 0!==r.getButton?r.getButton():null):s=this.buttonTemplate(q[t]),s&&(b=i.createElement("li"),k(s)?b.appendChild(s):b.innerHTML=s,h.appendChild(b))}return h},toolbarFormAnchor:function(){var b=i.createElement("div"),f=i.createElement("input"),e=i.createElement("a");return e.setAttribute("href","#"),e.innerHTML="&times;",f.setAttribute("type","text"),f.setAttribute("placeholder",this.options.anchorInputPlaceholder),b.className="medium-editor-toolbar-form-anchor",b.id="medium-editor-toolbar-form-anchor",b.appendChild(f),b.appendChild(e),b},bindSelect:function(){var b,f=this,e="";for(this.checkSelectionWrapper=function(c){return c&&f.clickingIntoArchorForm(c)?!1:(clearTimeout(e),void (e=setTimeout(function(){f.checkSelection()},f.options.delay)))},i.documentElement.addEventListener("mouseup",this.checkSelectionWrapper),b=0;b<this.elements.length;b+=1){this.elements[b].addEventListener("keyup",this.checkSelectionWrapper),this.elements[b].addEventListener("blur",this.checkSelectionWrapper)}return this},checkSelection:function(){var a,d;return this.keepToolbarAlive===!0||this.options.disableToolbar||(a=j.getSelection(),""===a.toString().trim()||this.options.allowMultiParagraphSelection===!1&&this.hasMultiParagraphs()?this.hideToolbarActions():(d=this.getSelectionElement(),!d||d.getAttribute("data-disable-toolbar")?this.hideToolbarActions():this.checkSelectionElement(a,d))),this},clickingIntoArchorForm:function(d){var c=this;return d.type&&"blur"===d.type.toLowerCase()&&d.relatedTarget&&d.relatedTarget===c.anchorInput?!0:!1},hasMultiParagraphs:function(){var d=l().replace(/<[\S]+><\/[\S]+>/gim,""),c=d.match(/<(p|h[0-6]|blockquote)>([\s\S]*?)<\/(p|h[0-6]|blockquote)>/g);return c?c.length:0},checkSelectionElement:function(e,d){var f;for(this.selection=e,this.selectionRange=this.selection.getRangeAt(0),f=0;f<this.elements.length;f+=1){if(this.elements[f]===d){return void this.setToolbarButtonStates().setToolbarPosition().showToolbarActions()}}this.hideToolbarActions()},getSelectionElement:function(){var a,v,u,t,s=j.getSelection(),r=function(e){var d=e;try{for(;!d.getAttribute("data-medium-element");){d=d.parentNode}}catch(f){return !1}return d};try{a=s.getRangeAt(0),v=a.commonAncestorContainer,u=v.parentNode,t=v.getAttribute("data-medium-element")?v:r(u)}catch(q){t=r(u)}return t},setToolbarPosition:function(){var a=50,v=j.getSelection(),u=v.getRangeAt(0),t=u.getBoundingClientRect(),s=this.options.diffLeft-this.toolbar.offsetWidth/2,r=(t.left+t.right)/2,q=this.toolbar.offsetWidth/2;return t.top<a?(this.toolbar.classList.add("medium-toolbar-arrow-over"),this.toolbar.classList.remove("medium-toolbar-arrow-under"),this.toolbar.style.top=a+t.bottom-this.options.diffTop+j.pageYOffset-this.toolbar.offsetHeight+"px"):(this.toolbar.classList.add("medium-toolbar-arrow-under"),this.toolbar.classList.remove("medium-toolbar-arrow-over"),this.toolbar.style.top=t.top+this.options.diffTop+j.pageYOffset-this.toolbar.offsetHeight+"px"),this.toolbar.style.left=q>r?s+q+"px":j.innerWidth-r<q?j.innerWidth+s-q+"px":s+r+"px",this.hideAnchorPreview(),this},setToolbarButtonStates:function(){var d,c=this.toolbarActions.querySelectorAll("button");for(d=0;d<c.length;d+=1){c[d].classList.remove(this.options.activeButtonClass)}return this.checkActiveButtons(),this},checkActiveButtons:function(){for(var d=Array.prototype.slice.call(this.elements),c=this.getSelectedParentElement();void 0!==c.tagName&&-1===this.parentElements.indexOf(c.tagName.toLowerCase)&&(this.activateButton(c.tagName.toLowerCase()),this.callExtensions("checkState",c),-1===d.indexOf(c));){c=c.parentNode}},activateButton:function(d){var c=this.toolbar.querySelector('[data-element="'+d+'"]');null!==c&&-1===c.className.indexOf(this.options.activeButtonClass)&&(c.className+=" "+this.options.activeButtonClass)},bindButtons:function(){var f,e=this.toolbar.querySelectorAll("button"),h=this,g=function(b){b.preventDefault(),b.stopPropagation(),void 0===h.selection&&h.checkSelection(),this.className.indexOf(h.options.activeButtonClass)>-1?this.classList.remove(h.options.activeButtonClass):this.className+=" "+h.options.activeButtonClass,this.hasAttribute("data-action")&&h.execAction(this.getAttribute("data-action"),b)};for(f=0;f<e.length;f+=1){e[f].addEventListener("click",g)}return this.setFirstAndLastItems(e),this},setFirstAndLastItems:function(b){return b.length>0&&(b[0].className+=" "+this.options.firstButtonClass,b[b.length-1].className+=" "+this.options.lastButtonClass),this},execAction:function(b,a){b.indexOf("append-")>-1?(this.execFormatBlock(b.replace("append-","")),this.setToolbarPosition(),this.setToolbarButtonStates()):"anchor"===b?this.triggerAnchorAction(a):"image"===b?i.execCommand("insertImage",!1,j.getSelection()):(i.execCommand(b,!1,null),this.setToolbarPosition())},rangeSelectsSingleNode:function(d){var c=d.startContainer;return c===d.endContainer&&c.hasChildNodes()&&d.endOffset===d.startOffset+1},getSelectedParentElement:function(){var d=null,c=this.selectionRange;return d=this.rangeSelectsSingleNode(c)?c.startContainer.childNodes[c.startOffset]:3===c.startContainer.nodeType?c.startContainer.parentNode:c.startContainer},triggerAnchorAction:function(){var b=this.getSelectedParentElement();return b.tagName&&"a"===b.tagName.toLowerCase()?i.execCommand("unlink",!1,null):"block"===this.anchorForm.style.display?this.showToolbarActions():this.showAnchorForm(),this},execFormatBlock:function(b){var d=this.getSelectionData(this.selection.anchorNode);if("blockquote"===b&&d.el&&"blockquote"===d.el.parentNode.tagName.toLowerCase()){return i.execCommand("outdent",!1,null)}if(d.tagName===b&&(b="p"),this.isIE){if("blockquote"===b){return i.execCommand("indent",!1,b)}b="<"+b+">"}return i.execCommand("formatBlock",!1,b)},getSelectionData:function(d){var c;for(d&&d.tagName&&(c=d.tagName.toLowerCase());d&&-1===this.parentElements.indexOf(c);){d=d.parentNode,d&&d.tagName&&(c=d.tagName.toLowerCase())}return{el:d,tagName:c}},getFirstChild:function(d){for(var c=d.firstChild;null!==c&&1!==c.nodeType;){c=c.nextSibling}return c},hideToolbarActions:function(){this.keepToolbarAlive=!1,void 0!==this.toolbar&&this.toolbar.classList.remove("medium-editor-toolbar-active")},showToolbarActions:function(){var d,c=this;this.anchorForm.style.display="none",this.toolbarActions.style.display="block",this.keepToolbarAlive=!1,clearTimeout(d),d=setTimeout(function(){c.toolbar&&!c.toolbar.classList.contains("medium-editor-toolbar-active")&&c.toolbar.classList.add("medium-editor-toolbar-active")},100)},saveSelection:function(){this.savedSelection=o()},restoreSelection:function(){n(this.savedSelection)},showAnchorForm:function(b){this.toolbarActions.style.display="none",this.saveSelection(),this.anchorForm.style.display="block",this.keepToolbarAlive=!0,this.anchorInput.focus(),this.anchorInput.value=b||""},bindAnchorForm:function(){var d=this.anchorForm.querySelector("a"),c=this;return this.anchorForm.addEventListener("click",function(b){b.stopPropagation()}),this.anchorInput.addEventListener("keyup",function(b){13===b.keyCode&&(b.preventDefault(),c.createLink(this))}),this.anchorInput.addEventListener("click",function(b){b.stopPropagation(),c.keepToolbarAlive=!0}),this.anchorInput.addEventListener("blur",function(){c.keepToolbarAlive=!1,c.checkSelection()}),d.addEventListener("click",function(b){b.preventDefault(),c.showToolbarActions(),n(c.savedSelection)}),this},hideAnchorPreview:function(){this.anchorPreview.classList.remove("medium-editor-anchor-preview-active")},showAnchorPreview:function(a){if(this.anchorPreview.classList.contains("medium-editor-anchor-preview-active")){return !0}var w,v,u,t=this,s=40,r=a.getBoundingClientRect(),q=(r.left+r.right)/2;return t.anchorPreview.querySelector("i").textContent=a.href,w=t.anchorPreview.offsetWidth/2,v=t.options.diffLeft-w,clearTimeout(u),u=setTimeout(function(){t.anchorPreview&&!t.anchorPreview.classList.contains("medium-editor-anchor-preview-active")&&t.anchorPreview.classList.add("medium-editor-anchor-preview-active")},100),t.observeAnchorPreview(a),t.anchorPreview.classList.add("medium-toolbar-arrow-over"),t.anchorPreview.classList.remove("medium-toolbar-arrow-under"),t.anchorPreview.style.top=Math.round(s+r.bottom-t.options.diffTop+j.pageYOffset-t.anchorPreview.offsetHeight)+"px",t.anchorPreview.style.left=w>q?v+w+"px":j.innerWidth-q<w?j.innerWidth+v-w+"px":v+q+"px",this},observeAnchorPreview:function(q){var h=this,v=(new Date).getTime(),u=!0,t=function(){v=(new Date).getTime(),u=!0},s=function(b){b.relatedTarget&&/anchor-preview/.test(b.relatedTarget.className)||(u=!1)},r=setInterval(function(){if(u){return !0}var a=(new Date).getTime()-v;a>h.options.anchorPreviewHideDelay&&(h.hideAnchorPreview(),clearInterval(r),h.anchorPreview.removeEventListener("mouseover",t),h.anchorPreview.removeEventListener("mouseout",s),q.removeEventListener("mouseover",t),q.removeEventListener("mouseout",s))},200);h.anchorPreview.addEventListener("mouseover",t),h.anchorPreview.addEventListener("mouseout",s),q.addEventListener("mouseover",t),q.addEventListener("mouseout",s)},createAnchorPreview:function(){var b=this,d=i.createElement("div");return d.id="medium-editor-anchor-preview-"+this.id,d.className="medium-editor-anchor-preview",d.innerHTML=this.anchorPreviewTemplate(),this.options.elementsContainer.appendChild(d),d.addEventListener("click",function(){b.anchorPreviewClickHandler()}),d},anchorPreviewTemplate:function(){return'<div class="medium-editor-toolbar-anchor-preview" id="medium-editor-toolbar-anchor-preview">    <i class="medium-editor-toolbar-anchor-preview-inner"></i></div>'},anchorPreviewClickHandler:function(){if(this.activeAnchor){var f=this,b=i.createRange(),a=j.getSelection();b.selectNodeContents(f.activeAnchor),a.removeAllRanges(),a.addRange(b),setTimeout(function(){f.activeAnchor&&f.showAnchorForm(f.activeAnchor.href),f.keepToolbarAlive=!1},100+f.options.delay)}this.hideAnchorPreview()},editorAnchorObserver:function(f){var e=this,h=!0,g=function(){h=!1,e.activeAnchor.removeEventListener("mouseout",g)};if(f.target&&"a"===f.target.tagName.toLowerCase()){if(!/href=["']\S+["']/.test(f.target.outerHTML)||/href=["']#\S+["']/.test(f.target.outerHTML)){return !0}if(this.toolbar.classList.contains("medium-editor-toolbar-active")){return !0}this.activeAnchor=f.target,this.activeAnchor.addEventListener("mouseout",g),setTimeout(function(){h&&e.showAnchorPreview(f.target)},e.options.delay)}},bindAnchorPreview:function(){var d,c=this;for(this.editorAnchorObserverWrapper=function(b){c.editorAnchorObserver(b)},d=0;d<this.elements.length;d+=1){this.elements[d].addEventListener("mouseover",this.editorAnchorObserverWrapper)}return this},checkLinkFormat:function(d){var c=/^(https?|ftps?|rtmpt?):\/\/|mailto:/;return(c.test(d)?"":"http://")+d},setTargetBlank:function(){var d,c=m();if("a"===c.tagName.toLowerCase()){c.target="_blank"}else{for(c=c.getElementsByTagName("a"),d=0;d<c.length;d+=1){c[d].target="_blank"}}},createLink:function(b){return 0===b.value.trim().length?void this.hideToolbarActions():(n(this.savedSelection),this.options.checkLinkFormat&&(b.value=this.checkLinkFormat(b.value)),i.execCommand("createLink",!1,b.value),this.options.targetBlank&&this.setTargetBlank(),this.checkSelection(),this.showToolbarActions(),void (b.value=""))},bindWindowActions:function(){var a,d=this;return this.windowResizeHandler=function(){clearTimeout(a),a=setTimeout(function(){d.toolbar&&d.toolbar.classList.contains("medium-editor-toolbar-active")&&d.setToolbarPosition()},100)},j.addEventListener("resize",this.windowResizeHandler),this},activate:function(){this.isActive||this.setup()},deactivate:function(){var a;if(this.isActive){for(this.isActive=!1,void 0!==this.toolbar&&(this.options.elementsContainer.removeChild(this.anchorPreview),this.options.elementsContainer.removeChild(this.toolbar),delete this.toolbar,delete this.anchorPreview),i.documentElement.removeEventListener("mouseup",this.checkSelectionWrapper),j.removeEventListener("resize",this.windowResizeHandler),a=0;a<this.elements.length;a+=1){this.elements[a].removeEventListener("mouseover",this.editorAnchorObserverWrapper),this.elements[a].removeEventListener("keyup",this.checkSelectionWrapper),this.elements[a].removeEventListener("blur",this.checkSelectionWrapper),this.elements[a].removeEventListener("paste",this.pasteWrapper),this.elements[a].removeAttribute("contentEditable"),this.elements[a].removeAttribute("data-medium-element")}}},htmlEntities:function(b){return String(b).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},bindPaste:function(){var b,d=this;for(this.pasteWrapper=function(c){var q,h,g="";if(this.classList.remove("medium-editor-placeholder"),!d.options.forcePlainText&&!d.options.cleanPastedHTML){return this}if(c.clipboardData&&c.clipboardData.getData&&!c.defaultPrevented){if(c.preventDefault(),d.options.cleanPastedHTML&&c.clipboardData.getData("text/html")){return d.cleanPaste(c.clipboardData.getData("text/html"))}if(d.options.disableReturn||this.getAttribute("data-disable-return")){i.execCommand("insertHTML",!1,c.clipboardData.getData("text/plain"))}else{for(q=c.clipboardData.getData("text/plain").split(/[\r\n]/g),h=0;h<q.length;h+=1){""!==q[h]&&(g+=navigator.userAgent.match(/firefox/i)&&0===h?d.htmlEntities(q[h]):"<p>"+d.htmlEntities(q[h])+"</p>")}i.execCommand("insertHTML",!1,g)}}},b=0;b<this.elements.length;b+=1){this.elements[b].addEventListener("paste",this.pasteWrapper)}return this},setPlaceholders:function(){var e,d=function(b){b.querySelector("img")||b.querySelector("blockquote")||""!==b.textContent.replace(/^\s+|\s+$/g,"")||b.classList.add("medium-editor-placeholder")},f=function(b){this.classList.remove("medium-editor-placeholder"),"keypress"!==b.type&&d(this)};for(e=0;e<this.elements.length;e+=1){d(this.elements[e]),this.elements[e].addEventListener("blur",f),this.elements[e].addEventListener("keypress",f)}return this},cleanPaste:function(b){var v,u,t,s=this.getSelectionElement(),r=/<p|<br|<div/.test(b),q=[[new RegExp(/<[^>]*docs-internal-guid[^>]*>/gi),""],[new RegExp(/<\/b>(<br[^>]*>)?$/gi),""],[new RegExp(/<span class="Apple-converted-space">\s+<\/span>/g)," "],[new RegExp(/<br class="Apple-interchange-newline">/g),"<br>"],[new RegExp(/<span[^>]*(font-style:italic;font-weight:bold|font-weight:bold;font-style:italic)[^>]*>/gi),'<span class="replace-with italic bold">'],[new RegExp(/<span[^>]*font-style:italic[^>]*>/gi),'<span class="replace-with italic">'],[new RegExp(/<span[^>]*font-weight:bold[^>]*>/gi),'<span class="replace-with bold">'],[new RegExp(/&lt;(\/?)(i|b|a)&gt;/gi),"<$1$2>"],[new RegExp(/&lt;a\s+href=(&quot;|&rdquo;|&ldquo;|“|”)([^&]+)(&quot;|&rdquo;|&ldquo;|“|”)&gt;/gi),'<a href="$2">']];for(v=0;v<q.length;v+=1){b=b.replace(q[v][0],q[v][1])}if(r){for(u=b.split("<br><br>"),this.pasteHTML("<p>"+u.join("</p><p>")+"</p>"),i.execCommand("insertText",!1,"\n"),u=s.querySelectorAll("p,div,br"),v=0;v<u.length;v+=1){switch(t=u[v],t.tagName.toLowerCase()){case"p":case"div":this.filterCommonBlocks(t);break;case"br":this.filterLineBreak(t)}}}else{this.pasteHTML(b)}},pasteHTML:function(b){var t,s,r,q,h=i.createDocumentFragment();for(h.appendChild(i.createElement("body")),q=h.querySelector("body"),q.innerHTML=b,this.cleanupSpans(q),t=q.querySelectorAll("*"),r=0;r<t.length;r+=1){s=t[r],s.removeAttribute("class"),s.removeAttribute("style"),s.removeAttribute("dir"),"meta"===s.tagName.toLowerCase()&&s.parentNode.removeChild(s)}i.execCommand("insertHTML",!1,q.innerHTML.replace(/&nbsp;/g," "))},isCommonBlock:function(b){return b&&("p"===b.tagName.toLowerCase()||"div"===b.tagName.toLowerCase())},filterCommonBlocks:function(b){/^\s*$/.test(b.innerText)&&b.parentNode.removeChild(b)},filterLineBreak:function(b){this.isCommonBlock(b.previousElementSibling)?b.parentNode.removeChild(b):!this.isCommonBlock(b.parentNode)||b.parentNode.firstChild!==b&&b.parentNode.lastChild!==b?1===b.parentNode.childElementCount&&this.removeWithParent(b):b.parentNode.removeChild(b)},removeWithParent:function(b){b&&b.parentNode&&(b.parentNode.parentNode&&1===b.parentNode.childElementCount?b.parentNode.parentNode.removeChild(b.parentNode):b.parentNode.removeChild(b.parentNode))},cleanupSpans:function(b){var r,q,h,g=b.querySelectorAll(".replace-with");for(r=0;r<g.length;r+=1){q=g[r],h=i.createElement(q.classList.contains("bold")?"b":"i"),h.innerHTML=q.classList.contains("bold")&&q.classList.contains("italic")?"<i>"+q.innerHTML+"</i>":q.innerHTML,q.parentNode.replaceChild(h,q)}for(g=b.querySelectorAll("span"),r=0;r<g.length;r+=1){q=g[r],/^\s*$/.test()?q.parentNode.removeChild(q):q.parentNode.replaceChild(i.createTextNode(q.innerText),q)}}}}(window,document);